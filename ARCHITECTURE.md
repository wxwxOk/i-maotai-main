# ièŒ…å°è‡ªåŠ¨é¢„çº¦å¾®ä¿¡å°ç¨‹åº - æ¶æ„è®¾è®¡

## ä¸€ã€ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              ç”¨æˆ·ç«¯                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚   å¾®ä¿¡å°ç¨‹åº     â”‚  â† ç”¨æˆ·æ“ä½œç•Œé¢                                         â”‚
â”‚  â”‚  - è´¦å·ç®¡ç†      â”‚                                                        â”‚
â”‚  â”‚  - é¢„çº¦é…ç½®      â”‚                                                        â”‚
â”‚  â”‚  - ç»“æœæŸ¥çœ‹      â”‚                                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚ HTTPS
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              åç«¯æœåŠ¡                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                         Node.js / Nest.js                           â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚  ç”¨æˆ·æ¨¡å—    â”‚  â”‚  é¢„çº¦æ¨¡å—    â”‚  â”‚  å®šæ—¶ä»»åŠ¡    â”‚  â”‚  æ¶ˆæ¯æ¨é€   â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ - å¾®ä¿¡ç™»å½•   â”‚  â”‚ - ièŒ…å°API  â”‚  â”‚ - æ¯æ—¥é¢„çº¦   â”‚  â”‚ - è®¢é˜…æ¶ˆæ¯  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ - è´¦å·ç»‘å®š   â”‚  â”‚ - ç­¾ååŠ å¯†   â”‚  â”‚ - ç»“æœæŸ¥è¯¢   â”‚  â”‚ - æ¨¡æ¿æ¶ˆæ¯  â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                    â”‚                              â”‚                          â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚         â–¼                     â–¼         â–¼                 â–¼                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚    MySQL    â”‚      â”‚    Redis    â”‚  â”‚   å¾®ä¿¡å¼€æ”¾å¹³å°API    â”‚             â”‚
â”‚  â”‚  - ç”¨æˆ·æ•°æ®  â”‚      â”‚  - ç¼“å­˜     â”‚  â”‚  - å°ç¨‹åºç™»å½•        â”‚             â”‚
â”‚  â”‚  - é¢„çº¦è®°å½•  â”‚      â”‚  - ä¼šè¯     â”‚  â”‚  - è®¢é˜…æ¶ˆæ¯æ¨é€      â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ HTTPS
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ièŒ…å°æœåŠ¡å™¨                                        â”‚
â”‚  app.moutai519.com.cn / static.moutai519.com.cn / h5.moutai519.com.cn      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## äºŒã€æŠ€æœ¯é€‰å‹

| å±‚çº§ | æŠ€æœ¯é€‰æ‹© | è¯´æ˜ |
|------|---------|------|
| å°ç¨‹åºç«¯ | åŸç”Ÿå¾®ä¿¡å°ç¨‹åº / Taro / uni-app | æ¨èuni-appï¼Œå¯è·¨ç«¯ |
| åç«¯æ¡†æ¶ | Node.js + Nest.js | TypeScriptæ”¯æŒå¥½ï¼Œé€‚åˆä¸­å°é¡¹ç›® |
| æ•°æ®åº“ | MySQL 8.0 | å­˜å‚¨ç”¨æˆ·å’Œé¢„çº¦æ•°æ® |
| ç¼“å­˜ | Redis | ä¼šè¯ç®¡ç†ã€æ¥å£ç¼“å­˜ |
| å®šæ—¶ä»»åŠ¡ | node-cron / Bull | æ¯æ—¥å®šæ—¶é¢„çº¦ |
| æ¶ˆæ¯æ¨é€ | å¾®ä¿¡è®¢é˜…æ¶ˆæ¯ | é¢„çº¦ç»“æœé€šçŸ¥ |
| éƒ¨ç½² | Docker + Nginx | å®¹å™¨åŒ–éƒ¨ç½² |

## ä¸‰ã€æ•°æ®åº“è®¾è®¡

### 3.1 ç”¨æˆ·è¡¨ (users)
```sql
CREATE TABLE users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    openid VARCHAR(64) NOT NULL UNIQUE COMMENT 'å¾®ä¿¡openid',
    unionid VARCHAR(64) COMMENT 'å¾®ä¿¡unionid',
    nickname VARCHAR(64) COMMENT 'å¾®ä¿¡æ˜µç§°',
    avatar_url VARCHAR(255) COMMENT 'å¤´åƒURL',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_openid (openid)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·è¡¨';
```

### 3.2 ièŒ…å°è´¦å·è¡¨ (mt_accounts)
```sql
CREATE TABLE mt_accounts (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL COMMENT 'å…³è”ç”¨æˆ·ID',
    mobile VARCHAR(20) NOT NULL COMMENT 'ièŒ…å°æ‰‹æœºå·',
    mt_user_id VARCHAR(32) COMMENT 'ièŒ…å°ç”¨æˆ·ID',
    token TEXT COMMENT 'ièŒ…å°Token',
    cookie TEXT COMMENT 'ièŒ…å°Cookie',
    device_id VARCHAR(64) COMMENT 'è®¾å¤‡ID',
    province_name VARCHAR(32) COMMENT 'çœä»½',
    city_name VARCHAR(32) COMMENT 'åŸå¸‚',
    lat VARCHAR(32) COMMENT 'çº¬åº¦',
    lng VARCHAR(32) COMMENT 'ç»åº¦',
    address VARCHAR(255) COMMENT 'è¯¦ç»†åœ°å€',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€: 1æ­£å¸¸ 0ç¦ç”¨',
    token_expire_at DATETIME COMMENT 'Tokenè¿‡æœŸæ—¶é—´',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_user_id (user_id),
    INDEX idx_mobile (mobile)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ièŒ…å°è´¦å·è¡¨';
```

### 3.3 é¢„çº¦é…ç½®è¡¨ (reservation_configs)
```sql
CREATE TABLE reservation_configs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    account_id BIGINT NOT NULL COMMENT 'å…³è”è´¦å·ID',
    item_codes VARCHAR(255) COMMENT 'å•†å“ä»£ç ,å¤šä¸ªç”¨@åˆ†éš”',
    shop_type TINYINT DEFAULT 1 COMMENT 'é—¨åº—ç±»å‹: 1å‡ºè´§é‡æœ€å¤§ 2è·ç¦»æœ€è¿‘',
    reserve_minute TINYINT DEFAULT 9 COMMENT 'é¢„çº¦åˆ†é’Ÿ(9ç‚¹åç¬¬å‡ åˆ†é’Ÿ)',
    random_minute TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦éšæœºåˆ†é’Ÿ: 0éšæœº 1å›ºå®š',
    auto_travel TINYINT DEFAULT 1 COMMENT 'è‡ªåŠ¨æ—…è¡Œ: 1å¼€å¯ 0å…³é—­',
    is_enabled TINYINT DEFAULT 1 COMMENT 'æ˜¯å¦å¯ç”¨: 1å¯ç”¨ 0ç¦ç”¨',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_account_id (account_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='é¢„çº¦é…ç½®è¡¨';
```

### 3.4 é¢„çº¦æ—¥å¿—è¡¨ (reservation_logs)
```sql
CREATE TABLE reservation_logs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    account_id BIGINT NOT NULL COMMENT 'å…³è”è´¦å·ID',
    item_id VARCHAR(32) COMMENT 'å•†å“ID',
    item_name VARCHAR(64) COMMENT 'å•†å“åç§°',
    shop_id VARCHAR(32) COMMENT 'é—¨åº—ID',
    shop_name VARCHAR(128) COMMENT 'é—¨åº—åç§°',
    status TINYINT COMMENT 'çŠ¶æ€: 0é¢„çº¦ä¸­ 1é¢„çº¦æˆåŠŸ 2é¢„çº¦å¤±è´¥ 3ä¸­ç­¾ 4æœªä¸­ç­¾',
    result_msg TEXT COMMENT 'ç»“æœä¿¡æ¯',
    reserve_date DATE COMMENT 'é¢„çº¦æ—¥æœŸ',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_account_id (account_id),
    INDEX idx_reserve_date (reserve_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='é¢„çº¦æ—¥å¿—è¡¨';
```

### 3.5 å•†å“è¡¨ (items)
```sql
CREATE TABLE items (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    item_id VARCHAR(32) NOT NULL UNIQUE COMMENT 'å•†å“ID',
    title VARCHAR(128) COMMENT 'å•†å“åç§°',
    content VARCHAR(255) COMMENT 'å•†å“æè¿°',
    picture_url VARCHAR(255) COMMENT 'å›¾ç‰‡URL',
    price DECIMAL(10,2) COMMENT 'ä»·æ ¼',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å•†å“è¡¨';
```

## å››ã€åç«¯APIæ¥å£è®¾è®¡

### 4.1 ç”¨æˆ·æ¨¡å—

```typescript
// å¾®ä¿¡ç™»å½•
POST /api/auth/wx-login
Request: { code: string }
Response: { token: string, userInfo: object }

// è·å–ç”¨æˆ·ä¿¡æ¯
GET /api/user/info
Response: { id, openid, nickname, avatarUrl, accounts: [] }
```

### 4.2 ièŒ…å°è´¦å·æ¨¡å—

```typescript
// å‘é€éªŒè¯ç 
POST /api/mt/send-code
Request: { mobile: string }
Response: { success: boolean }

// ç™»å½•ièŒ…å°
POST /api/mt/login
Request: { mobile: string, code: string }
Response: { success: boolean, account: object }

// è·å–è´¦å·åˆ—è¡¨
GET /api/mt/accounts
Response: { accounts: [] }

// åˆ é™¤è´¦å·
DELETE /api/mt/accounts/:id

// æ›´æ–°è´¦å·ä½ç½®
PUT /api/mt/accounts/:id/location
Request: { province, city, lat, lng, address }
```

### 4.3 é¢„çº¦é…ç½®æ¨¡å—

```typescript
// è·å–å¯é¢„çº¦å•†å“åˆ—è¡¨
GET /api/mt/items
Response: { items: [] }

// è·å–é¢„çº¦é…ç½®
GET /api/mt/accounts/:id/config
Response: { config: object }

// æ›´æ–°é¢„çº¦é…ç½®
PUT /api/mt/accounts/:id/config
Request: { itemCodes, shopType, reserveMinute, randomMinute, autoTravel, isEnabled }

// æ‰‹åŠ¨è§¦å‘é¢„çº¦
POST /api/mt/accounts/:id/reserve
Response: { success: boolean, logs: [] }
```

### 4.4 æ—¥å¿—æ¨¡å—

```typescript
// è·å–é¢„çº¦æ—¥å¿—
GET /api/mt/logs
Query: { accountId?, page, pageSize, startDate?, endDate? }
Response: { total, list: [] }

// è·å–ä»Šæ—¥é¢„çº¦çŠ¶æ€
GET /api/mt/today-status
Response: { accounts: [{ accountId, status, items: [] }] }
```

## äº”ã€å°ç¨‹åºé¡µé¢è®¾è®¡

```
pages/
â”œâ”€â”€ index/                    # é¦–é¡µ - ä»Šæ—¥é¢„çº¦çŠ¶æ€æ¦‚è§ˆ
â”‚   â””â”€â”€ index.wxml/js/wxss
â”œâ”€â”€ accounts/                 # è´¦å·ç®¡ç†
â”‚   â”œâ”€â”€ list.wxml            # è´¦å·åˆ—è¡¨
â”‚   â”œâ”€â”€ add.wxml             # æ·»åŠ è´¦å·ï¼ˆè¾“å…¥æ‰‹æœºå·+éªŒè¯ç ï¼‰
â”‚   â””â”€â”€ detail.wxml          # è´¦å·è¯¦æƒ…ï¼ˆä½ç½®ã€é…ç½®ï¼‰
â”œâ”€â”€ reserve/                  # é¢„çº¦é…ç½®
â”‚   â”œâ”€â”€ config.wxml          # é¢„çº¦è®¾ç½®ï¼ˆå•†å“é€‰æ‹©ã€é—¨åº—ç±»å‹ã€æ—¶é—´ï¼‰
â”‚   â””â”€â”€ items.wxml           # å•†å“é€‰æ‹©é¡µ
â”œâ”€â”€ logs/                     # é¢„çº¦è®°å½•
â”‚   â””â”€â”€ list.wxml            # å†å²è®°å½•åˆ—è¡¨
â””â”€â”€ user/                     # ä¸ªäººä¸­å¿ƒ
    â””â”€â”€ index.wxml           # è®¾ç½®ã€å…³äº
```

### é¡µé¢åŸå‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ièŒ…å°è‡ªåŠ¨é¢„çº¦              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä»Šæ—¥é¢„çº¦çŠ¶æ€               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ 138****8888             â”‚â”‚
â”‚  â”‚ é£å¤©èŒ…å° âœ“ å·²é¢„çº¦       â”‚â”‚
â”‚  â”‚ ç”Ÿè‚–èŒ…å° âœ“ å·²é¢„çº¦       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ 139****9999             â”‚â”‚
â”‚  â”‚ é£å¤©èŒ…å° â³ å¾…å¼€å¥–       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [+] æ·»åŠ è´¦å·               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ é¦–é¡µ  ğŸ“‹è®°å½•  ğŸ‘¤æˆ‘çš„     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å…­ã€å®šæ—¶ä»»åŠ¡è®¾è®¡

```typescript
// å®šæ—¶ä»»åŠ¡é…ç½®
const schedules = [
  {
    name: 'åˆ·æ–°å•†å“å’Œé—¨åº—',
    cron: '0 0 8 * * *',      // æ¯å¤©8:00
    handler: refreshShopsAndItems
  },
  {
    name: 'æ‰§è¡Œé¢„çº¦',
    cron: '0 0-30 9 * * *',   // æ¯å¤©9:00-9:30æ¯åˆ†é’Ÿæ‰§è¡Œ
    handler: executeReservation
  },
  {
    name: 'æŸ¥è¯¢é¢„çº¦ç»“æœ',
    cron: '0 0 18 * * *',     // æ¯å¤©18:00
    handler: queryReservationResults
  },
  {
    name: 'æ—…è¡Œå¥–åŠ±',
    cron: '0 30 9-19 * * *',  // æ¯å¤©9:30-19:30æ¯å°æ—¶æ‰§è¡Œ
    handler: getTravelReward
  }
];
```

## ä¸ƒã€æ¶ˆæ¯æ¨é€è®¾è®¡

### 7.1 è®¢é˜…æ¶ˆæ¯æ¨¡æ¿

**é¢„çº¦æˆåŠŸé€šçŸ¥**
```
é¢„çº¦ç»“æœé€šçŸ¥
å•†å“åç§°: {{thing1.DATA}}
é¢„çº¦æ—¶é—´: {{date2.DATA}}
é¢„çº¦çŠ¶æ€: {{phrase3.DATA}}
å¤‡æ³¨: {{thing4.DATA}}
```

**ä¸­ç­¾é€šçŸ¥**
```
ä¸­ç­¾é€šçŸ¥
å•†å“åç§°: {{thing1.DATA}}
ä¸­ç­¾é—¨åº—: {{thing2.DATA}}
æ”¯ä»˜æˆªæ­¢: {{date3.DATA}}
æè´§æˆªæ­¢: {{date4.DATA}}
```

### 7.2 æ¨é€é€»è¾‘

```typescript
// æ¨é€æ—¶æœº
1. æ¯æ—¥é¢„çº¦å®Œæˆå â†’ æ¨é€é¢„çº¦ç»“æœ
2. æŸ¥è¯¢åˆ°ä¸­ç­¾å â†’ æ¨é€ä¸­ç­¾é€šçŸ¥
3. Tokenå³å°†è¿‡æœŸ â†’ æ¨é€é‡æ–°ç™»å½•æé†’
```

## å…«ã€é¡¹ç›®ç›®å½•ç»“æ„

### 8.1 åç«¯ (server/)

```
server/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ common/                    # å…¬å…±æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ decorators/           # è£…é¥°å™¨
â”‚   â”‚   â”œâ”€â”€ filters/              # å¼‚å¸¸è¿‡æ»¤å™¨
â”‚   â”‚   â”œâ”€â”€ guards/               # å®ˆå«
â”‚   â”‚   â”œâ”€â”€ interceptors/         # æ‹¦æˆªå™¨
â”‚   â”‚   â””â”€â”€ utils/                # å·¥å…·ç±»
â”‚   â”‚       â”œâ”€â”€ crypto.util.ts    # åŠ å¯†å·¥å…·(MD5/AES)
â”‚   â”‚       â””â”€â”€ http.util.ts      # HTTPè¯·æ±‚å°è£…
â”‚   â”œâ”€â”€ modules/
â”‚   â”‚   â”œâ”€â”€ auth/                 # è®¤è¯æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”‚   â”‚   â””â”€â”€ jwt.strategy.ts
â”‚   â”‚   â”œâ”€â”€ user/                 # ç”¨æˆ·æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ mt-account/           # ièŒ…å°è´¦å·æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ mt-account.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ mt-account.service.ts
â”‚   â”‚   â”‚   â””â”€â”€ mt-account.entity.ts
â”‚   â”‚   â”œâ”€â”€ mt-api/               # ièŒ…å°APIå°è£…
â”‚   â”‚   â”‚   â”œâ”€â”€ mt-api.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ mt-shop.service.ts
â”‚   â”‚   â”‚   â””â”€â”€ mt-reserve.service.ts
â”‚   â”‚   â”œâ”€â”€ reservation/          # é¢„çº¦æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ scheduler/            # å®šæ—¶ä»»åŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ scheduler.module.ts
â”‚   â”‚   â”‚   â””â”€â”€ tasks/
â”‚   â”‚   â”‚       â”œâ”€â”€ reserve.task.ts
â”‚   â”‚   â”‚       â”œâ”€â”€ result.task.ts
â”‚   â”‚   â”‚       â””â”€â”€ travel.task.ts
â”‚   â”‚   â””â”€â”€ wechat/               # å¾®ä¿¡ç›¸å…³
â”‚   â”‚       â”œâ”€â”€ wechat.service.ts
â”‚   â”‚       â””â”€â”€ subscribe-message.service.ts
â”‚   â”œâ”€â”€ app.module.ts
â”‚   â””â”€â”€ main.ts
â”œâ”€â”€ prisma/                       # æ•°æ®åº“è¿ç§» (æˆ– TypeORM)
â”‚   â””â”€â”€ schema.prisma
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

### 8.2 å°ç¨‹åº (miniprogram/)

```
miniprogram/
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ index/                    # é¦–é¡µ
â”‚   â”œâ”€â”€ accounts/                 # è´¦å·ç®¡ç†
â”‚   â”œâ”€â”€ reserve/                  # é¢„çº¦é…ç½®
â”‚   â”œâ”€â”€ logs/                     # é¢„çº¦è®°å½•
â”‚   â””â”€â”€ user/                     # ä¸ªäººä¸­å¿ƒ
â”œâ”€â”€ components/                   # ç»„ä»¶
â”‚   â”œâ”€â”€ account-card/            # è´¦å·å¡ç‰‡
â”‚   â”œâ”€â”€ item-selector/           # å•†å“é€‰æ‹©å™¨
â”‚   â””â”€â”€ status-badge/            # çŠ¶æ€å¾½ç« 
â”œâ”€â”€ services/                     # APIæœåŠ¡
â”‚   â”œâ”€â”€ api.js                   # è¯·æ±‚å°è£…
â”‚   â”œâ”€â”€ auth.js                  # è®¤è¯ç›¸å…³
â”‚   â””â”€â”€ mt.js                    # ièŒ…å°ç›¸å…³
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ request.js               # ç½‘ç»œè¯·æ±‚
â”‚   â””â”€â”€ storage.js               # æœ¬åœ°å­˜å‚¨
â”œâ”€â”€ app.js
â”œâ”€â”€ app.json
â”œâ”€â”€ app.wxss
â””â”€â”€ project.config.json
```

## ä¹ã€å®‰å…¨è€ƒè™‘

1. **TokenåŠ å¯†å­˜å‚¨** - æ•°æ®åº“ä¸­çš„ièŒ…å°Tokenåº”åŠ å¯†å­˜å‚¨
2. **æ¥å£é‰´æƒ** - æ‰€æœ‰APIéœ€è¦JWTè®¤è¯
3. **è¯·æ±‚é™æµ** - é˜²æ­¢é¢‘ç¹è°ƒç”¨ièŒ…å°API
4. **æ•æ„Ÿä¿¡æ¯è„±æ•** - æ—¥å¿—ä¸­æ‰‹æœºå·ç­‰ä¿¡æ¯è„±æ•å¤„ç†
5. **HTTPS** - å…¨é“¾è·¯HTTPSåŠ å¯†

## åã€éƒ¨ç½²æ–¹æ¡ˆ

```yaml
# docker-compose.yml
version: '3.8'
services:
  app:
    build: ./server
    ports:
      - "3000:3000"
    depends_on:
      - mysql
      - redis
    environment:
      - DB_HOST=mysql
      - REDIS_HOST=redis

  mysql:
    image: mysql:8.0
    volumes:
      - mysql_data:/var/lib/mysql
    environment:
      - MYSQL_ROOT_PASSWORD=xxx
      - MYSQL_DATABASE=imaotai

  redis:
    image: redis:7-alpine
    volumes:
      - redis_data:/data

volumes:
  mysql_data:
  redis_data:
```
